<!DOCTYPE HTML>
<html>
<head>
	<meta http-equiv="content-type" content="text/html" />
	<meta name="author" content="" />

	<title>Dashboard Map</title>
 
</head>

<body>

        <h1>Dashboard</h1>
        <table>
            <tr>
                <td>
                    <table>
                        <tr>
                            <td id="t_context" valign="top">
                                <div id="radios">
                                    <div id="radio_state"class="s_r_c">State</div>
                                    <div id="radio_region"class="s_r_c">Region</div>
                                    <div id="radio_county"class="s_r_c">County</div>
                                    
                                </div>
                            </td> 
                            <td id="t_trend" valign="top"></td>                    
                        </tr>
                    </table>
                </td>
            </tr>
            <tr>
                <td id="t_population" style="padding-top:30px"></td>
            </tr>
        </table>
<script type="text/javascript" src="js/d3.js"></script>
<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>
<script type="text/javascript" src="js/population.js"></script>
<script type="text/javascript" src="js/sparkline.js"></script>
<script type="text/javascript" src="js/wa_geo_map.js"></script>
<script type="text/javascript" src="js/wa_geo_map_region.js"></script>
<script type="text/javascript" src="js/data_county.js"></script>


<link rel="stylesheet" href="css/style.css" type="text/css"/>

<script>

     
           var context_w = 685,
               context_h = 350,
               map_w = context_w * 0.4379,
               //map_h = context_h * 0.8571,
               map_h =330,
               //map_x = (context_w-2*map_w),
               map_x = (context_w/2-map_w),
               map_y = ((context_h-map_h)/2),
               map_loc = [{x:map_x,y:map_y}],
     
               population_w = 182,
               population_h = 100,
     
               sparkline_w = 300,
               sparkline_h = 25;
            
            //population fast fact
            var population_chart = d3.population()
                    .population_w(population_w)
                    .population_h(population_h);
                
            var margin_p = {top: 0, right: 5, bottom: 0, left: 0},
                width_p = 197 - margin_p.left - margin_p.right,
                height_p = 100 - margin_p.top - margin_p.bottom;
                
            //key foster care trend
            var sparkline_chart = d3.sparkline()
                    .sparkline_w(sparkline_w)
                    .sparkline_h(sparkline_h);
                
            var margin_t = {top: 5, right: 10, bottom: 5, left: 14},
                width_t = 300 - margin_t.left - margin_t.right,
                height_t = 73 - margin_t.top - margin_t.bottom;
            
            // scope: state, county, region         
            var scope = "county";           
            
            // store the place selected
            var current_status = "Washington";
            
            // default setting for user
            var default_county = "King",  
                default_region = "region_2_south";  
            
            //index in the data
            var current_pointer;
            
            var color_main = "#3B6E8F";
                color_highlight = "#A3DCE6";
                color_map_highlight = "#A3DCE6";
            
            // color for each level
            var color_l_1 = d3.hsl(color_main).brighter(1.5),  
                color_l_2 = color_main,
                color_l_3 = d3.hsl(color_main).darker(0.8),
                color_l_4 = d3.hsl(color_main).darker(2),
                color_l_5 = d3.hsl(color_main).darker(2.5),
                color_l_6 = d3.hsl(color_main).darker(3);
            
            // color for each region
            var color_rigon_1 = d3.hsl(color_main).brighter(0.7),
                color_rigon_2 = d3.hsl(color_main).brighter(1.5),
                color_rigon_3 = d3.hsl(color_main).brighter(1.2),
                color_rigon_4 = color_main,
                color_rigon_5 = d3.hsl(color_main).darker(0.5),
                color_rigon_6 = d3.hsl(color_main).darker(0.8);
             
            var svg_map = d3.select("#t_context").append("svg")
                    .attr("width",context_w)
                    .attr("height",context_h)
                    .attr("id","svg_context")
                    .append("g")
                    .attr("id","chart_context")
                    .attr("transform","translate(10,10)");
                   
            var wa_map = svg_map.append("g")
                    .attr("id","wa_map"); 
                    
            d3.select("#wa_map").data(map_loc).enter();
            wa_map.attr("transform",function(d){ return "translate("+d.x+","+d.y+")"; });
                 
            var nav_bar = svg_map.append("g")
                    .attr("id","nav_bar")
                    .attr("transform","translate("+(context_w - 210 - 20)+",0)"); 
            
             
            var sub_description = svg_map.append("g")
                    .attr("id","sub_description")
                    .attr("transform","translate(0,0)"); 
            
            var svg_population = d3.select("#t_population").append("svg")
                    .attr("id","svg_population");             
                       
            var svg_trend = d3.select("#t_trend").append("svg")
                    .attr("id","svg_trend");
            
            //DATA IN CONTEXT
            
            //map for county
            var svg = d3.select("#wa_map").call(wa_geo_map);
    
            d3.select("#wa_geo_map")
                .attr("height",map_h);                

            d3.select("#wa_geo_map").selectAll("g").attr("checked","false"); 
            
            //map for region
             var svg = d3.select("#wa_map").call(wa_geo_map_region);            
    
            d3.select("#wa_geo_map_region")
               // .attr("transform","translate(0, -49)")
                .attr("height",map_h*1.33);  
                                
            d3.select("#wa_geo_map_region").selectAll("g")
                .attr("transform","translate(0, -79)");

            d3.select("#wa_geo_map_region").selectAll("text").style("display","none");  
            d3.select("#wa_geo_map_region").selectAll("path")
                .style("stroke","white")
                .style("display","none"); 
               
            d3.select("#wa_geo_map_region").selectAll("text")
                .style("font-size","28px");

            d3.select("#wa_geo_map_region").selectAll("g").attr("checked","false"); 
            
            //style state/region/county buttons                           
            d3.select("#radios").selectAll("div")
                .attr("checked","unchecked")
                .style("border-color",d3.hsl(color_main).brighter(1.2));
                
            //sub_description                                    
            d3.select("#t_context span").append("text")
                .attr("id","sub_description_title")
                .text(
                // replace '-' with ' ', and make the first letter upercase
                    default_region.replace(/_/g," ").replace(/(^|\s+)\w/g,function(s){ 
                        return s.toUpperCase();
                        })
                    );   
                
            d3.select("#sub_description").append("text")
                .attr("id","sub_description_measure")
                .attr("transform","translate(-10,6)")
                .text("Percent Employment");
            
            var measure_desc = d3.select("#sub_description").append("g")
                .attr("transform","translate(-10,20)")
                .attr("class","measure_desc");
            
            var m_1 = measure_desc.append("g")
                .attr("transform","translate(5,0)")
                .attr("id","mea_level_1");
            m_1.append("circle")
                .attr("r",4.5)
                .attr("fill",color_l_1);
            m_1.append("text")
                .text("0% - 20%")
                .attr("dy", ".51em")
                .attr("x",15);
                
            var m_2 = measure_desc.append("g")
                .attr("transform","translate(5,13)")
                .attr("id","mea_level_2");
            m_2.append("circle")
                .attr("r",4.5)
                .attr("fill",color_l_2);
            m_2.append("text")
                .text("20% - 40%")
                .attr("dy", ".51em")
                .attr("x",15);
                
            var m_3 = measure_desc.append("g")
                .attr("transform","translate(5,26)")
                .attr("id","mea_level_3");
            m_3.append("circle")
                .attr("r",4.5)
                .attr("fill",color_l_3);
            m_3.append("text")
                .text("40% - 60%")
                .attr("dy", ".51em")
                .attr("x",15);
                
            var m_4 = measure_desc.append("g")
                .attr("transform","translate(5,39)")
                .attr("id","mea_level_4");
            m_4.append("circle")
                .attr("r",4.5)
                .attr("fill",color_l_4);
            m_4.append("text")
                .text("60% - 80%")
                .attr("dy", ".51em")
                .attr("x",15);
            
             var m_5 = measure_desc.append("g")
                .attr("transform","translate(5,52)")
                .attr("id","mea_level_5");
             m_5.append("circle")
                .attr("r",4.5)
                .attr("fill",color_l_5);
             m_5.append("text")
                .text("80% - 100%")
                .attr("dy", ".51em")
                .attr("x",15);
                            
            //initialize current pointer
            get_current_pointer(default_county);
                 
            //initialize data in context
            d3.select("#radio_county").attr('checked', 'checked').style("border-color",color_map_highlight); 
            d3.select("#sub_description_title").text(default_county);
            
            //initialize map
            map_county();   
              
            //initialize population fast fact 
            population_fast_fact(current_pointer);
                 
            //initialize foster care trends
            foster_care_trends(current_pointer);
                 
            //initialize tool tips     
            tool_tip();
            
            //hide the ranking
            d3.select("#sub_description").style("display","none");
            
            d3.select("#radios").selectAll("div")
                .on("mouseover",function(){
                        d3.select(this).style("border-color",d3.hsl(color_map_highlight).brighter(0.5));
                })
                .on("mouseout",function(){
                    if(d3.select(this).attr("checked")=="unchecked"){
                            d3.select(this).style("border-color",d3.hsl(color_main).brighter(1.2));
                        }else{
                            d3.select(this).style("border-color",color_map_highlight);    
                        }
                })
                
            //state radio
            d3.select("#radio_state").on("click",function(){
                
                 d3.select("#radios").selectAll("div")
                    .attr('checked', 'unchecked')
                    .style("border-color",d3.hsl(color_main).brighter(1.2));
                    
                 d3.select("#radio_state")
                    .attr('checked', 'checked');
                 
                 d3.select(this).style("border-color",color_map_highlight); 
                 
                 d3.select("#sub_description_title")
                    .text("Washington");
                 
                 d3.select("#sub_description").style("display","none");
                     
                 map_state();
                 
                 population_fast_fact(0);
                 
                 foster_care_trends(0);
                 
                 tool_tip();
                 
              })
              
            //region radio
            d3.select("#radio_region").on("click",function(){
                
                d3.select("#radios").selectAll("div")
                    .attr('checked', 'unchecked')
                    .style("border-color",d3.hsl(color_main).brighter(1.2));
                    
                d3.select("#radio_region")
                    .attr('checked', 'checked');
                
                d3.select(this)
                    .style("border-color",color_map_highlight); 
                
                d3.select("#sub_description_title")
                    .text(default_region); 
                
                d3.select("#sub_description").style("display","none");
                   
                map_region();
                
                /*get_current_pointer(default_region);
                population_fast_fact(current_pointer);                
                foster_care_trends(current_pointer);*/
                
                tool_tip();
             })
             
             //county radio 
             d3.select("#radio_county").on("click",function(){
                
                d3.select("#radios").selectAll("div")
                    .attr('checked', 'unchecked')
                    .style("border-color",d3.hsl(color_main).brighter(1.2));
                    
                 d3.select("#radio_county")
                    .attr('checked', 'checked');
                 
                 d3.select(this)
                    .style("border-color",color_map_highlight); 
                 
                 d3.select("#sub_description_title")
                    .text(default_county);
                 
                 d3.select("#sub_description").style("display","none");
                 
                 map_county();
                 
                 get_current_pointer(default_county);
                 
                 population_fast_fact(current_pointer);  
                               
                 foster_care_trends(current_pointer);
                 
                 tool_tip();
                 
             })
                                                                  
             // interations on WA map 
             function map_state(){
                scope = "state";
                d3.select("#wa_geo_map").selectAll("path").style("display","block");  
                d3.select("#wa_geo_map_region").selectAll("path").style("display","none");
                d3.select("#sub_description_title").text("Washington");             
                d3.select("#wa_geo_map").selectAll("path").style("fill",d3.hsl(color_main).brighter(1.2)).style("stroke",d3.hsl(color_main).brighter(1.2));
                d3.select("#wa_geo_map_region").selectAll("path").style("display","none");
                d3.select("#wa_geo_map").selectAll("g")
                    .on("mouseover",function(){
                        d3.select("#wa_geo_map").selectAll("path").style("fill",d3.hsl(color_map_highlight).brighter(0.5)).style("stroke",d3.hsl(color_map_highlight).brighter(0.5));
                    })
                    .on("mouseout",function(){
                        d3.select("#wa_geo_map").selectAll("path").style("fill",d3.hsl(color_main).brighter(1.2)).style("stroke",d3.hsl(color_main).brighter(1.2));
                    })
                    .on("click",function(){});
             }
             
             function map_county(){                               
                 //change scope 
                 scope = "county";
                 
                 // clear all settings   
                 d3.select("#wa_geo_map").selectAll("g").attr("checked","false");
                 d3.select("#wa_geo_map").selectAll("path").style("display","block");  
                 d3.select("#wa_geo_map_region").selectAll("path").style("display","none");              
                 d3.select("#wa_geo_map").selectAll("path").style("fill",d3.hsl(color_main).brighter(1.2)).style("stroke","white");
                 
                 // default setting 
                 d3.select("#"+default_county).attr("checked","true"); 
                 d3.select("#"+default_county).selectAll("path").style("fill",color_map_highlight);
                 d3.select("#sub_description_title").text(default_county);
                 
                 var fill_color;
                 // mouse events 
                 d3.select("#wa_geo_map").selectAll("g")
                 // when hover, changes county color and shows county name 
                 .on("mouseover",function(){
                    fill_color = d3.select(this).selectAll("path").style("fill");
                    d3.select(this).selectAll("path").style("fill",d3.hsl(color_map_highlight).brighter(0.5));
                 })
                 // when mouse out, changes county color and hides county name 
                 .on("mouseout",function(){
                   d3.select(this).selectAll("path").style("fill",fill_color);
                 })
                 // when click on a county, changes county color and change sub title
                 .on("click",function(){
                    fill_color = color_map_highlight;
                    d3.select("#wa_geo_map").selectAll("path").style("fill",d3.hsl(color_main).brighter(1.2));
                    d3.select("#wa_geo_map").selectAll("g").attr("checked","false");
                    d3.select(this).attr("checked","true");
                    d3.select(this).selectAll("path").style("fill",fill_color);
                    var county_id = d3.select(this).attr("id");
                    d3.select("#sub_description_title").text(county_id.replace("_", " "));
                    current_status = d3.select(this).attr("id");                    
                    // change display at fast fact and population
                    get_current_pointer(county_id);
                    population_fast_fact(current_pointer);                
                    foster_care_trends(current_pointer);
                    tool_tip();                     
                 });            
             }
             
             function map_region(){                           /***************map region********************/
                //change scope 
                scope = "region"; 
                
                // clear all settings   
                d3.select("#wa_geo_map").selectAll("path").style("display","none");    
                d3.select("#wa_geo_map_region").selectAll("g").attr("checked","false");         
                d3.select("#wa_geo_map_region").selectAll("path")
                    .style("display","block")
                    .style("fill",d3.hsl(color_main).brighter(1.2));
                
                // default setting 
                d3.selectAll("."+default_region).attr("checked","true"); 
                d3.selectAll("."+default_region).selectAll("path").style("fill",color_map_highlight);
                d3.select("#sub_description_title").text(
                // replace '-' with ' ', and make the first letter upercase
                    default_region.replace(/_/g," ").replace(/(^|\s+)\w/g,function(s){ 
                        return s.toUpperCase();
                        })
                    );   
                
                var fill_color;
                // mouse events 
                 d3.select("#wa_geo_map_region").selectAll("g")
                 // when hover, changes region color and shows region name 
                 .on("mouseover",function(){
                    fill_color = d3.select(this).selectAll("path").style("fill");
                    d3.select(this).selectAll("path").style("fill",d3.hsl(color_map_highlight).brighter(0.5));         
                 })
                 // when mouse out, changes region color and hides region name 
                 .on("mouseout",function(){
                    d3.select(this).selectAll("path").style("fill",fill_color); 
                 })
                 // when click on a region, changes region color and change sub title
                 .on("click",function(){
                    fill_color = color_map_highlight;
                    d3.select("#wa_geo_map_region").selectAll("path").style("fill",d3.hsl(color_main).brighter(1.2));
                    d3.select("#wa_geo_map_region").selectAll("g").attr("checked","false");
                    d3.select(this).attr("checked","true");
                    d3.select(this).selectAll("path").style("fill",fill_color);
                    var region_name = d3.select(this).attr("name");
                    var region_class = d3.select(this).attr("class");
                    d3.select("#sub_description_title").text(region_name);
                    current_status = d3.select(this).attr("class");
                    /*console.log(current_status);*/  
                    
                    // change display at fast fact and population
                    /*
                        get_current_pointer(region_class);
                        population_fast_fact(current_pointer);                
                        foster_care_trends(current_pointer);
                        tool_tip();
                        */                       
                 });    
             }
  
             function population_fast_fact(current_pointer){
                     
                     d3.selectAll(".population").remove();
                     
                     d3.select("#svg_population")
                          .attr("width",(width_p + margin_p.left + margin_p.right) * 5)
                          .attr("height",height_p + margin_p.top + margin_p.bottom)
                          .selectAll("g")
                          .data(data_county[current_pointer]["population_fast_fact"]).enter()
                          .append("g")
                          .attr("class","population")
                          .attr("transform", function(d, i){ return "translate(" + (margin_p.left + (width_p + margin_p.left + margin_p.right) * i) + "," + margin_p.top + ")"; })
                          .call(population_chart);
                          
                     d3.selectAll(".population").on("mouseover",function(){
                           d3.select(this).select(".population_axis path").style("stroke",d3.hsl(color_main).brighter(0.5));                 
                          })
                          .on("mouseout",function(){
                            if(d3.select(this).attr("checked") != "true"){
                                d3.select(this).select(".population_axis path").style("stroke","#555");
                            }else{
                                d3.select(this).select(".population_axis path").style("stroke",color_main);
                            }   
                          })
                          .on("click",function(){
                            d3.selectAll(".population").attr("checked","false").selectAll(".population_axis path").style("stroke","#555");  
                            d3.select(this).attr("checked","true");
                            d3.select(this).select(".population_axis path").style("stroke",color_main);
                            map_ranking(scope, "population_fast_fact", d3.select(this).select("svg").attr("id"));
                          });
                 }
              
             function foster_care_trends(current_pointer){
                    d3.selectAll(".sparkline").remove();
                    d3.selectAll(".sparkline_axis").remove();
                    d3.selectAll(".sparkline_lines").remove();
                    d3.select("#svg_trend")
                          .attr("width",width_t + margin_t.left + margin_t.right)
                          .attr("height",(height_t + margin_t.top + margin_t.bottom)*5 + 50)
                          .selectAll("g")
                          .data(data_county[current_pointer]["foster_care_trend"]).enter()
                          .append("g")
                          .attr("class","sparkline")
                          .attr("transform", function(d, i){ return "translate(" + margin_t.left + "," + ((margin_t.top + (height_t + margin_t.top + margin_t.bottom)) * i) + ")";})
                          .call(sparkline_chart);
                    
                     d3.selectAll(".sparkline").on("mouseover",function(){
                           d3.select(this).select(".trend_line").style("stroke",d3.hsl(color_main).brighter(0.5));                 
                          })
                          .on("mouseout",function(){
                            if(d3.select(this).attr("checked") != "true"){
                                d3.select(this).select(".trend_line").style("stroke","#555");
                            }else{
                                d3.select(this).select(".trend_line").style("stroke",color_main);
                            }   
                          })
                          .on("click",function(){
                            d3.selectAll(".sparkline").attr("checked","false").selectAll(".trend_line").style("stroke","#555");  
                            d3.select(this).attr("checked","true");
                            d3.select(this).select(".trend_line").style("stroke",color_main);           
                            map_ranking(scope, "foster_care_trend", d3.select(this).select(".trend").attr("id"));
                          }); 
                  } 

              // get location's ID                                                    /***************************currently, we only show the data base on county level****************************************/
              function get_current_pointer(default_county){
                   for(var i=0; i < data_county.length; i++){
                    if(data_county[i]["id"] == default_county){
                        current_pointer = i;
                    }
                 }
              }
              
               // tool tips, term descrptions  
               function tool_tip(){

                   var fast_fact_desc = [
                            {"id":"trend_0","title":"Entries/1000","descrption":"The minimum and maximum date for which reliable data are available are indicated on the slide bar. You can adjust the bar to any range; the default is the full date range."},
                            {"id":"trend_1","title":"Age 0-4 Entres","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"},
                            {"id":"trend_2","title":"Reunfication within 1 Year","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"},
                            {"id":"trend_3","title":"Percent Entries with Dependency","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"},
                            {"id":"trend_4","title":"Median Days in Care","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"},
                            ]; 
                   var population_desc = [
                            {"id":"population_0","title":"Population under 18","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"},
                            {"id":"population_1","title":"Poverty","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"},
                            {"id":"population_2","title":"Unemployment","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"},
                            {"id":"population_3","title":"Employment","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"},
                            {"id":"population_4","title":"Population over 18","descrption":"bla bla bla bla bla bla bla bla bla bla bla bl"}
                            ];
                            
                   var tip_f_0 = d3.tip()
                          .attr('class', 'd3-tip')
                          .offset([-10, 0])
                          .html(function(d) {
                            return "<strong>" + fast_fact_desc[0]["title"] + "</strong> <br /><span>" + fast_fact_desc[0]["descrption"] + "</span>";
                          })
              
                   var tip_f_1 = d3.tip()
                          .attr('class', 'd3-tip')
                          .offset([-10, 0])
                          .html(function(d) {
                            return "<strong>" + fast_fact_desc[1]["title"] + "</strong> <br /><span>" + fast_fact_desc[1]["descrption"] + "</span>";
                          })
                          
                    var tip_f_2 = d3.tip()
                          .attr('class', 'd3-tip')
                          .offset([-10, 0])
                          .html(function(d) {
                            return "<strong>" + fast_fact_desc[2]["title"] + "</strong> <br /><span>" + fast_fact_desc[2]["descrption"] + "</span>";
                          })
                          
                    var tip_f_3 = d3.tip()
                          .attr('class', 'd3-tip')
                          .offset([-10, 0])
                          .html(function(d) {
                            return "<strong>" + fast_fact_desc[3]["title"] + "</strong> <br /><span>" + fast_fact_desc[3]["descrption"] + "</span>";
                          })
                          
                    var tip_f_4 = d3.tip()
                          .attr('class', 'd3-tip')
                          .offset([-10, 0])
                          .html(function(d) {
                            return "<strong>" + fast_fact_desc[4]["title"] + "</strong> <br /><span>" + fast_fact_desc[4]["descrption"] + "</span>";
                          })
                                  
                       d3.select("#svg_trend").call(tip_f_0); 
                       d3.select("#trend_0").select(".sparkline_title").on('mouseover', tip_f_0.show)
                                .on('mouseout', tip_f_0.hide);
                        
                       d3.select("#svg_trend").call(tip_f_1); 
                       d3.select("#trend_1").select(".sparkline_title").on('mouseover', tip_f_1.show)
                                .on('mouseout', tip_f_1.hide);
                                
                       d3.select("#svg_trend").call(tip_f_2); 
                       d3.select("#trend_2").select(".sparkline_title").on('mouseover', tip_f_2.show)
                                .on('mouseout', tip_f_2.hide);
                                
                       d3.select("#svg_trend").call(tip_f_3); 
                       d3.select("#trend_3").select(".sparkline_title").on('mouseover', tip_f_3.show)
                                .on('mouseout', tip_f_3.hide);
                                
                       d3.select("#svg_trend").call(tip_f_4); 
                       d3.select("#trend_4").select(".sparkline_title").on('mouseover', tip_f_4.show)
                                .on('mouseout', tip_f_4.hide);
                      
                       var tip_p_0 = d3.tip()
                          .attr('class', 'd3-tip')
                          .offset([-10, 0])
                          .html(function(d) {
                            return "<strong>" + population_desc[0]["title"] + "</strong> <br /><span>" + population_desc[0]["descrption"] + "</span>";
                          })
              
                       var tip_p_1 = d3.tip()
                              .attr('class', 'd3-tip')
                              .offset([-10, 0])
                              .html(function(d) {
                                return "<strong>" + population_desc[1]["title"] + "</strong> <br /><span>" + population_desc[1]["descrption"] + "</span>";
                              })
                              
                        var tip_p_2 = d3.tip()
                              .attr('class', 'd3-tip')
                              .offset([-10, 0])
                              .html(function(d) {
                                return "<strong>" + population_desc[2]["title"] + "</strong> <br /><span>" + population_desc[2]["descrption"] + "</span>";
                              })
                              
                        var tip_p_3 = d3.tip()
                              .attr('class', 'd3-tip')
                              .offset([-10, 0])
                              .html(function(d) {
                                return "<strong>" + population_desc[3]["title"] + "</strong> <br /><span>" + population_desc[3]["descrption"] + "</span>";
                              })
                              
                        var tip_p_4 = d3.tip()
                              .attr('class', 'd3-tip')
                              .offset([-10, 0])
                              .html(function(d) {
                                return "<strong>" + population_desc[4]["title"] + "</strong> <br /><span>" + population_desc[4]["descrption"] + "</span>";
                              })
                                  
                       d3.select("#svg_population").call(tip_p_0); 
                       d3.select("#population_0").select(".text_title").on('mouseover', tip_p_0.show)
                                .on('mouseout', tip_p_0.hide);
                        
                       d3.select("#svg_population").call(tip_p_1); 
                       d3.select("#population_1").select(".text_title").on('mouseover', tip_p_1.show)
                                .on('mouseout', tip_p_1.hide);
                                
                       d3.select("#svg_population").call(tip_p_2); 
                       d3.select("#population_2").select(".text_title").on('mouseover', tip_p_2.show)
                                .on('mouseout', tip_p_2.hide);
                                
                       d3.select("#svg_population").call(tip_p_3); 
                       d3.select("#population_3").select(".text_title").on('mouseover', tip_p_3.show)
                                .on('mouseout', tip_p_3.hide);
                                
                       d3.select("#svg_population").call(tip_p_4); 
                       d3.select("#population_4").select(".text_title").on('mouseover', tip_p_4.show)
                                .on('mouseout', tip_p_4.hide);
                        
              }

              function map_ranking(scope, category, id){ //categrory ["foster_care_trend" or "population_fast_fact"]; id is the "id" inside that category
                if(scope == "county"){
                    var counties = get_ranking(category, id);
                    for(var i=0; i<counties.length; i++){
                        for(var j=0; j<3; j++){
                            d3.selectAll("#"+counties[i][0]).selectAll("path").style("fill",counties[i][2]);
                        }
                    } 
                } 
              }
              
              function get_ranking(category, id){ //categrory ["foster_care_trend" or "population_fast_fact"]; id is the "id" inside that category
                    var counties = new Array(data_county.length);
                    var index;
                    var name;
                    if(category == "foster_care_trend"){
                        name = "current";
                        index = id.substr(6, 1);
                    }else{
                        name = "statistic";
                        index = id.substr(11, 1);
                    }
                    for(var i=0; i<data_county.length; i++){
                        counties[i] = new Array(3);
                        counties[i][0] = data_county[i]["id"], 
                        counties[i][1] = data_county[i][category][index][name],
                        counties[i][2] = 0
                    }
                    
                    var max_value = counties[0][1];
                    var min_value = counties[0][1];
                    for(var i=1; i<counties.length; i++){
                        if(max_value < counties[i][1]){
                            max_value = counties[i][1];
                        }
                        if(min_value > counties[i][1]){
                            min_value = counties[i][1];
                        }
                    }
                
                    var range = ((max_value - min_value)/5);
                    //var Level_1 = min_value;
                    var Level_2 = range+ min_value;
                    var Level_3 = 2*range+ min_value;
                    var Level_4 = 3*range+ min_value;
                    var Level_5 = 4*range+ min_value;
                    
                    d3.select("#sub_description").style("display","block");
                     
                    d3.select("#sub_description_measure").text(data_county[0][category][index]["title"]);
                    
                    for(var i=1; i<=5; i++){
                        d3.select("#mea_level_"+i).select("text").text((min_value + range * (i-1)).toFixed(2) + " - " + (min_value + range * i).toFixed(2));
                    }
                    
                    for(var i=0; i<counties.length; i++){
                        if(counties[i][1] <= Level_2){
                            counties[i][2] = color_l_1;
                        }else if(counties[i][1] > Level_2 && counties[i][1] <= Level_3){
                            counties[i][2] = color_l_2;
                        }else if(counties[i][1] > Level_3 && counties[i][1] <= Level_4){
                            counties[i][2] = color_l_3;
                        }else if(counties[i][1] > Level_4 && counties[i][1] <= Level_5){
                            counties[i][2] = color_l_4;
                        }else{
                            counties[i][2] = color_l_5;
                        }
                    } 
                    return counties;
                } 
               
              //test for trend
              /*
              function map_ranking2(scope, current_pointer){ 
                        if(scope == "county"){
                            test();
                        }else if(scope == "region"){
                            test();
                        }
                        
                        function test(){
                            var age_0_4_entries_under_30 = ["Adams",
                                        "Asotin",
                                        "Benton",
                                        "Chelan",
                                        "Jefferson",
                                        "King",
                                        "Cowlitz",
                                        "Douglas",
                                        "Ferry"
                                        ],
                            age_0_4_entries_30_50 = ["Franklin",
                                        "Grant",
                                        "Grays_Harbor",
                                        "Island",
                                        "Kitsap",
                                        "San_Juan",
                                        "Skamania"
                                        ],
                            age_0_4_entries_50_80 = ["Wahkiakum",
                                        "Thurston",
                                        "Pend_Oreille",
                                        "Pierce",
                                         "Whatcom",
                                         "Clallam",
                                        "Clark",
                                        "Skagit",
                                        "Snohomish",
                                       "Spokane",
                                        "Stevens"
                                        ],
                             age_0_4_entries_above_80 = ["Columbia",
                                        "Garfield",
                                        "Lincoln",
                                        "Walla_Walla", 
                                        "Kittitas",
                                        "Klickitat",
                                        "Lewis",
                                        "Mason",
                                        "Okanogan",
                                        "Pacific",               
                                        "Whitman",
                                        "Yakima"
                                        ],
                             col_age_0_4_entries_under_30 = color_l_1,
                             col_age_0_4_entries_30_50 = color_l_2,
                             col_age_0_4_entries_50_80 = color_l_3,
                             col_age_0_4_entries_above_80 = color_l_4;
                    
                         
                         for(var i=0,len=age_0_4_entries_under_30.length;i<len;i++){
                            d3.select("#"+age_0_4_entries_under_30[i]).selectAll("path").style("fill",col_age_0_4_entries_under_30);
                         }
                         
                         for(var i=0,len=age_0_4_entries_50_80.length;i<len;i++){
                            d3.select("#"+age_0_4_entries_50_80[i]).selectAll("path").style("fill",col_age_0_4_entries_50_80);
                         }
                         
                         for(var i=0,len=age_0_4_entries_above_80.length;i<len;i++){
                            d3.select("#"+age_0_4_entries_above_80[i]).selectAll("path").style("fill",col_age_0_4_entries_above_80);
                         }
                    }
              } 
              */ 

      
</script>


</body>
</html>